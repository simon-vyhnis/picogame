from game import SnakeGame, CarGame, DinoGame
from time import sleep
import framebuf


class Menu:
    def __init__(self, display, mother_led, controls, sound):
        self.display = display
        self.controls = controls
        self.items =[MenuItem(CarGame(display, mother_led, controls, sound), "Car Racing", car_img), MenuItem(SnakeGame(display, mother_led, controls, sound), "Snake", snake_img), MenuItem(DinoGame(display, mother_led, controls, sound), "Dino", dino_img)]
    def choose_game(self):
        current_item = 0
        selected_item = -1
        cooldown = 0
        while selected_item < 0:
            cooldown = 0
            self.display.fill(0)
            self.display.text("Choose game", 10, 5, 1)
            self.display.line(0, 17, 128, 17, 1)
            self.items[current_item].show(self.display)
            self.display.invert(1)
            self.display.show()
            if(self.controls.button_right.value()):
                current_item += 1
                cooldown = 0.6
            if(self.controls.button_left.value()):
                current_item -= 1
                cooldown = 0.6
            if current_item < 0:
                current_item = len(self.items)-1
            if current_item >= len(self.items):
                current_item = 0
            if(self.controls.button_up.value()):
                selected_item = current_item
            sleep(cooldown)   
        return self.items[selected_item].game
            
        
class MenuItem:
    def __init__(self, game, title, img):
        self.game = game
        self.title = title
        self.img = img
    def show(self, display):
        display.text(self.title, 10, 52, 1)
        fb = self.img() # get the image byte array
        display.blit(fb, 10, 19) # show the image at location

        
def snake_img():
    fb = framebuf.FrameBuffer(bytearray(
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
        b'\x80\x40\x30\x08\x08\x04\x82\x82\x8a\x82\x84\x44\x78\x40\x40\xe0\x90\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x30\xcc\x02\x02'
        b'\xe2\x12\x12\x09\x09\x09\x89\x49\x4a\x8a\x0a\x12\x24\xc4\x0c\x12\x22\xd2\x09\x08\x04\x02\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00'
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x80\x40\xa0\x90\x50\x49\x26\x20\x13\x22\x44\x44\x44\x84\x88\x90\x90\x93\x88\x04\x02\x01'
        b'\x00\x80\x40\x3f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x03\x02\x02\x01\x00\x00'
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
        b'\x00\x00\x00\x00\x00\x00\x00\x00'),
        50, 32, framebuf.MONO_VLSB)
    return fb

def car_img():
    fb = framebuf.FrameBuffer(bytearray(
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0\xf0\xf8\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\x38\xf8\xf0'
        b'\xc0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xc0\xe0\xf0\xf8\x7f\x7f\xf7\xf0\xf0\xf0\xf0\xf0\xf0\xf0\xf0\xf0'
        b'\xf0\xf0\xf0\xf0\xf0\xf0\xf0\xf0\xf0\xf0\xf7\x7f\x7e\xf8\xe0\xe0\xc0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\xf8\xf8'
        b'\xf0\xf8\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xf8\xf0\xf8\xf8\xff\xff\xff\x00\x00\x00\x00'
        b'\x00\x00\x00\x00\x00\x00\x01\x01\x03\x3f\x7f\x7f\x3f\x1f\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x1f'
        b'\x3f\x7f\x3f\x3f\x01\x01\x01\x00\x00\x00\x00\x00'),
        43, 32, framebuf.MONO_VLSB)
    return fb
def dino_img():
    fb = framebuf.FrameBuffer(bytearray(
        b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfc\xfc\xfe\xe6\xf6\xfe\xfe\xfe\xfe\xfe\xfe\xfe\xfc\xfc\x00\x00\x00'
        b'\x00\x00\xf0\xc0\x00\x00\x00\x00\x00\x80\xc0\xc0\xe0\xe0\xf0\xff\xff\xff\xff\xff\xff\x47\xc5\x04\x04\x04\x00\x00\x00\x00\x00\x00'
        b'\x00\x00\x07\x1f\x7f\x7e\xfe\xfe\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\x1f\x0f\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00'
        b'\x00\x00\x00\x00\x00\x00\x00\x01\x7f\x6f\x4f\x07\x01\x01\x07\x7f\x7f\x40\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'),
        32, 32, framebuf.MONO_VLSB)
    return fb


